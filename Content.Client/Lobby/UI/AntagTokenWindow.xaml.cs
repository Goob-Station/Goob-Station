using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.CustomControls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.Lobby.UI;

[GenerateTypedNameReferences]
public sealed partial class AntagTokenWindow : DefaultWindow
{
    public event Action<bool>? OnReadyPressed;

    public AntagTokenWindow(int tokenCount, bool onCooldown)
    {
        RobustXamlLoader.Load(this);

        UpdateTokenState(tokenCount, onCooldown);

        ActivateButton.OnPressed += _ =>
        {
            OnReadyPressed?.Invoke(true);
            Close();
        };

        ReadyWithoutButton.OnPressed += _ =>
        {
            OnReadyPressed?.Invoke(false);
            Close();
        };
    }

    public void UpdateTokenState(int tokenCount, bool onCooldown)
    {
        TokenCountLabel.Text = tokenCount > 0
            ? Loc.GetString("antag-token-count", ("count", tokenCount))
            : Loc.GetString("antag-token-count-zero");

        ActivateButton.Disabled = tokenCount <= 0 || onCooldown;

        if (onCooldown && tokenCount > 0)
            TokenCountLabel.Text += "\n" + Loc.GetString("antag-token-on-cooldown");
    }
}
