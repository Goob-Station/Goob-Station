using Content.Client.UserInterface.Controls;
using Content.Goobstation.Shared.Keypad;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.CustomControls;
using Robust.Client.UserInterface.XAML;
using System;

namespace Content.Goobstation.Client.Keypad.UI;

[GenerateTypedNameReferences]
public sealed partial class KeypadMenu : FancyWindow
{
    public event Action<int>? OnDigitPressed;
    public event Action? OnClearPressed;
    public event Action? OnEnterPressed;

    public KeypadMenu()
    {
        RobustXamlLoader.Load(this);
        FillGrid();
    }

    private void FillGrid()
    {
        for (var i = 1; i <= 9; i++)
            AddButton(i);

        var clear = new Button { Text = "C" };
        clear.OnPressed += _ => OnClearPressed?.Invoke();
        KeypadGrid.AddChild(clear);

        AddButton(0);

        var enter = new Button { Text = "E" };
        enter.OnPressed += _ => OnEnterPressed?.Invoke();
        KeypadGrid.AddChild(enter);
    }

    private void AddButton(int i)
    {
        var btn = new Button { Text = i.ToString() };
        btn.OnPressed += _ => OnDigitPressed?.Invoke(i);
        KeypadGrid.AddChild(btn);
    }

    public void UpdateState(KeypadUiState state)
    {
        StatusLabel.Text =
            new string('*', state.EnteredLength) +
            new string('_', state.MaxLength - state.EnteredLength);
    }
}
