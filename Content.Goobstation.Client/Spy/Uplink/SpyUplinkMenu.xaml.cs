using Content.Goobstation.Shared.Spy;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.CustomControls;
using Robust.Client.UserInterface.XAML;

namespace Content.Goobstation.Client.Spy.Uplink;

[GenerateTypedNameReferences]
public sealed partial class SpyUplinkMenu : DefaultWindow
{

    private List<SpyBountyData> _cachedBounties = new();
    public event Action<BaseButton.ButtonEventArgs, SpyBountyData>? OnBountyButtonPressed;

    public SpyUplinkMenu()
    {
        RobustXamlLoader.Load(this);
        IoCManager.InjectDependencies(this);
    }

    public void UpdateBounty(List<SpyBountyData> bounties)
    {
        _cachedBounties = bounties;

        UpdateBounty();
    }

    public void UpdateBounty()
    {
        ClearBounties();
        foreach (var item in _cachedBounties)
        {
            AddBountyGui(item);
        }
    }
    private void AddBountyGui(SpyBountyData bounty)
    {
        var newListing = new BountyListingControl(bounty);
        newListing.SetTexture();
        newListing.ClaimButton.OnButtonDown += args => OnBountyButtonPressed?.Invoke(args, bounty);
        UplinkBountyContainer.AddChild(newListing);
    }

    private void ClearBounties()
    {
        UplinkBountyContainer.Children.Clear();
    }
}
