# SPDX-FileCopyrightText: 2025 Aiden <28298836+Aidenkrz@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 Aidenkrz <aiden@djkraz.com>
# SPDX-FileCopyrightText: 2025 Aviu00 <93730715+Aviu00@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 GoobBot <uristmchands@proton.me>
# SPDX-FileCopyrightText: 2025 Ilya246 <57039557+Ilya246@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 Ilya246 <ilyukarno@gmail.com>
# SPDX-FileCopyrightText: 2025 SolsticeOfTheWinter <solsticeofthewinter@gmail.com>
# SPDX-FileCopyrightText: 2025 TheBorzoiMustConsume <197824988+TheBorzoiMustConsume@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 gluesniffler <159397573+gluesniffler@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 gus <august.eymann@gmail.com>
# SPDX-FileCopyrightText: 2025 loltart <159829224+loltart@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 loltart <lo1tartyt@gmail.com>
#
# SPDX-License-Identifier: AGPL-3.0-or-later

- type: entity
  parent: Traitor
  id: TraitorMidround
  components:
  - type: StationEvent
    earliestStart: 30
    weight: 8
    minimumPlayers: 15
    maxOccurrences: 1
    startAnnouncement: station-event-communication-interception
    startAudio:
      path: /Audio/Announcements/intercept.ogg
    duration: null
    occursDuringRoundEnd: false
    chaos:
      Hostile: 100
      Medical: 100
      Death: 100
    eventType: HostilesSpawn
  - type: GameRule
    chaosScore: 250
  - type: AlertLevelInterceptionRule
  - type: AntagSelection
    selectionTime: PostPlayerSpawn
    definitions:
    - prefRoles: [ TraitorSleeper ]
      fallbackRoles: [ Traitor ]
      min: 1
      max: 2
      playerRatio: 10
      blacklist:
        components:
        - AntagImmune
        - CommandStaff
      lateJoinAdditional: true
      mindRoles:
      - MindRoleTraitor
  - type: Tag
    tags:
      - MidroundAntag

# Midround Changelings
- type: entity
  parent: Changeling
  id: ChangelingMidround
  components:
  - type: StationEvent
    earliestStart: 20
    weight: 3
    minimumPlayers: 15
    maxOccurrences: 1
    startAnnouncement: station-event-communication-interception
    startAudio:
      path: /Audio/Announcements/intercept.ogg
    duration: null
    occursDuringRoundEnd: false
    chaos:
      Hostile: 150
      Medical: 150
      Death: 150
    eventType: HostilesSpawn
  - type: GameRule
    chaosScore: 300
  - type: AlertLevelInterceptionRule
  - type: AntagSelection
    selectionTime: PostPlayerSpawn
    agentName: changeling-roundend-name
    definitions:
    - prefRoles: [ Changeling ]
      min: 1
      max: 2
      playerRatio: 10
      blacklist:
        components:
        - CommandStaff
        - AntagImmune
        - BibleUser
      lateJoinAdditional: true
      mindRoles:
      - MindRoleChangelingmidround
  - type: Tag
    tags:
      - MidroundAntag

# Midround Heretics
- type: entity
  parent: Heretic
  id: HereticMidround
  components:
  - type: StationEvent
    earliestStart: 20
    weight: 3
    minimumPlayers: 30
    maxOccurrences: 1
    startAnnouncement: station-event-communication-interception
    startAudio:
      path: /Audio/Announcements/intercept.ogg
    duration: null
    occursDuringRoundEnd: false
    chaos:
      Hostile: 200
      Medical: 150
      Death: 200
    eventType: HostilesSpawn
  - type: GameRule
    chaosScore: 300
  - type: AlertLevelInterceptionRule
  - type: AntagSelection
    selectionTime: PostPlayerSpawn
    agentName: heretic-roundend-name
    definitions:
    - prefRoles: [ Heretic ]
      min: 1
      max: 2
      playerRatio: 15
      blacklist:
        components:
        - CommandStaff
        - AntagImmune
        - BibleUser
      lateJoinAdditional: true
      jobBlacklist: [ Chaplain ] # GOOBSTATION
      mindRoles:
      - MindRoleHeretic
  - type: Tag
    tags:
      - MidroundAntag

# Midround Revolutionaries
- type: entity
  parent: Revolutionary
  id: RevolutionaryMidround
  components:
  - type: StationEvent
    earliestStart: 20
    weight: 3
    minimumPlayers: 30
    maxOccurrences: 1
    duration: null
    occursDuringRoundEnd: false
    chaos:
      Hostile: 250
      Medical: 250
      Death: 250
    eventType: HostilesSpawn
  - type: GameRule
    chaosScore: 800
  - type: AntagSelection
    selectionTime: PostPlayerSpawn
    definitions:
    - prefRoles: [ HeadRev ]
      max: 3
      playerRatio: 15
      blacklist:
        components:
        - AntagImmune
        - CommandStaff
      briefing:
        text: head-rev-role-greeting
        color: CornflowerBlue
        sound: "/Audio/Ambience/Antag/headrev_start.ogg"
      startingGear: HeadRevGear
      components:
      - type: Revolutionary
      - type: HeadRevolutionary
      mindRoles:
      - MindRoleHeadRevolutionary
  - type: Tag
    tags:
      - MidroundAntag

# Skeleton Spawn
- type: entity
  parent: BaseGameRule
  id: SkeletonMidround
  components:
  - type: StationEvent
    weight: 5
    duration: 1
    minimumPlayers: 15
    chaos:
      Hostile: 40
      Medical: 40
      Death: 40
    eventType: Chaotic
  - type: GameRule
    chaosScore: 90
  - type: RandomEntityStorageSpawnRule
    prototype: MobSkeletonCloset
  - type: Tag
    tags:
      - MidroundAntag

# Blob Midround
- type: entity
  parent: BaseGameRule
  id: BlobMidround
  components:
  - type: StationEvent
    weight: 1
    earliestStart: 45
    minimumPlayers: 50
    duration: null
    maxOccurrences: 1
    chaos:
      Hostile: 400
      Medical: 400
      Death: 400
    eventType: HostilesSpawn
  - type: GameRule
    chaosScore: 1000
  - type: BlobSpawnRule
    carrierBlobProtos:
    - SpawnPointGhostBlobRat
    playersPerCarrierBlob: 30
    maxCarrierBlob: 1
  - type: Tag
    tags:
      - MidroundAntag

- type: entity
  parent: BaseGameRule
  id: FloorGoblinMidRound
  components:
  - type: StationEvent
    weight: 15
    earliestStart: 15
    minimumPlayers: 15
    maxOccurrences: 2
    eventType: Neutral
  - type: GameRule
    chaosScore: 0
  - type: VentCrittersRule
    max: 1
    table:
      id: MobFloorGoblin
  - type: Tag

# Midround Devil
- type: entity
  parent: Devil
  id: Devilmidround
  components:
  - type: StationEvent
    earliestStart: 20
    weight: 1
    minimumPlayers: 30
    maxOccurrences: 1
    startAnnouncement: station-event-communication-interception
    startAudio:
      path: /Audio/Announcements/intercept.ogg
    duration: null
    occursDuringRoundEnd: false
    chaos:
      Hostile: 200
      Medical: 150
      Death: 200
    eventType: HostilesSpawn
  - type: GameRule
    chaosScore: 400
  - type: AlertLevelInterceptionRule
  - type: AntagSelection
    selectionTime: PostPlayerSpawn
    agentName: devil-roundend-name
    definitions:
    - prefRoles: [ Devil ]
      max: 1
      playerRatio: 15
      blacklist:
        components:
        - CommandStaff
        - AntagImmune
        - BibleUser
      lateJoinAdditional: true
      jobBlacklist: [ Chaplain ] # GOOBSTATION
      mindRoles:
      - DevilMindRole
  - type: Tag
    tags:
      - MidroundAntag

# Slasher
- type: entity
  parent: BaseGameRule
  id: SlasherSpawn
  components:
  - type: StationEvent
    weight: 3
    duration: null
    earliestStart: 30
    minimumPlayers: 30
    chaos:
      Hostile: 40
      Combat: 40
      Death: 40
    eventType: HostilesSpawn
  - type: GameRule
    chaosScore: 400
  - type: AntagRandomSpawn
  - type: AntagLoadProfileRule
    speciesOverride: Human
    speciesOverrideBlacklist:
    - Yowie
    - IPC
    - Diona
    - Harpy
    - Plasmaman
  - type: AntagObjectives
    objectives:
    - SlasherSurviveObjective
    - SlasherAbsorbSoulsObjective
  - type: AntagSelection
    selectionTime: PostPlayerSpawn
    agentName: slasher-round-end-agent-name
    definitions:
    - spawnerPrototype: SpawnPointGhostSlasher
      min: 1
      max: 1
      pickPlayer: false
      startingGear: SlasherGear
      briefing:
        text: slasher-role-greeting
        color: Red
        sound: /Audio/_Goobstation/Effects/Slasher/SlasherIntro.ogg
      mindRoles:
      - MindRoleSlasher
      components:
      - type: Slasher
      - type: SlasherSummonMachete
      - type: SlasherStaggerArea
      - type: SlasherRegenerate
      - type: SlasherPossession
      - type: SlasherBloodTrail
      - type: SlasherIncorporeal
      - type: SlasherSoulSteal
      - type: SlasherSummonMeatSpike
      - type: BreathingImmunity
      - type: GunBlocked
        PopupText: slasher-cannot-use-guns # Seems to be broken inside AntagSelection
      - type: WeakToHoly
      - type: NightVision
        activateSound: null
        deactivateSound: null
      - type: Hunger
        baseDecayRate: 0
      - type: Thirst
        baseDecayRate: 0
      - type: RandomMetadata
        nameSegments:
        - NamesSlasherTitle
        - NamesSlasher
        nameFormat: name-format-slasher
  - type: Tag
    tags:
    - MidroundAntag
