# todo: write friendship logic for htn
- type: htnCompound
  id: ChickenCompound
  branches:
  - tasks:
    - !type:HTNCompoundTask
      task: ChickenFoodCompound
  - tasks:
    - !type:HTNCompoundTask
      task: MeleeCombatCompound
  - tasks:
    - !type:HTNCompoundTask
      task: IdleCompound

- type: htnCompound
  id: ChickenFoodCompound
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      preconditions:
      - !type:HungryPrecondition
        minHungerState: Starving
      operator: !type:UtilityOperator
        proto: NearbyChickenFood

    - !type:HTNPrimitiveTask
      operator: !type:MoveToOperator
        pathfindInPlanning: true
        removeKeyOnFinish: false
        targetKey: TargetCoordinates
        pathfindKey: TargetPathfind
        rangeKey: MeleeRange

    - !type:HTNPrimitiveTask
      preconditions:
      - !type:KeyExistsPrecondition
        key: Target
      operator: !type:AltInteractOperator

    - !type:HTNPrimitiveTask
      preconditions:
      - !type:KeyExistsPrecondition
        key: IdleTime
      operator: !type:WaitOperator
        key: IdleTime

  # Picks nearby drink then consumes it and waits idle time
  - tasks:
    - !type:HTNPrimitiveTask
      preconditions:
      - !type:ThirstyPrecondition
        minThirstState: Parched  # See ThirstThreshold enum
      operator: !type:UtilityOperator
        proto: NearbyDrink

    - !type:HTNPrimitiveTask
      operator: !type:MoveToOperator
        pathfindInPlanning: true
        removeKeyOnFinish: false
        targetKey: TargetCoordinates
        pathfindKey: TargetPathfind
        rangeKey: MeleeRange

    - !type:HTNPrimitiveTask
      preconditions:
      - !type:KeyExistsPrecondition
        key: Target
      operator: !type:AltInteractOperator

    - !type:HTNPrimitiveTask
      preconditions:
      - !type:KeyExistsPrecondition
        key: IdleTime
      operator: !type:WaitOperator
        key: IdleTime

- type: utilityQuery
  id: NearbyChickenFood
  query:
  - !type:ComponentQuery
    components:
    - type: ChickenFood
  considerations:
  - !type:TargetIsAliveCon
    curve: !type:InverseBoolCurve
  - !type:TargetDistanceCon
    curve: !type:PresetCurve
      preset: TargetDistance
  - !type:FoodValueCon
    curve: !type:QuadraticCurve
      slope: 1.0
      exponent: 0.4
  - !type:TargetAccessibleCon
    curve: !type:BoolCurve
