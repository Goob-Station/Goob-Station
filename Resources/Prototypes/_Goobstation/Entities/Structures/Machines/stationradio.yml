- type: entity
  id: VinylPlayer
  name: vinyl player
  parent: [ BaseMachinePowered, SmallConstructibleMachine ]
  description: An old school vinyl record player sat on a set of drawers.
  components:
  - type: Sprite
    sprite: _Goobstation/Structures/Machines/StationRadio/vinylplayer.rsi
    snapCardinals: true
    granularLayersRendering: true
    layers:
    - state: icon
    - state: unlit
      shader: unshaded
      map: [ "enum.PowerDeviceVisualLayers.Powered" ]
    - state: panel
      map: ["enum.WiresVisualLayers.MaintenancePanel"]
    drawdepth: SmallObjects
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.10,-0.10,0.10,0.10"
        density: 500
        mask:
        - TabletopMachineMask
        layer:
        - BulletImpassable
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: MetalGlassBreak
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: Appearance
  - type: WiresPanel
  - type: WiresVisuals
  - type: VinylPlayer
  - type: ApcPowerReceiver
    powerLoad: 300 # This is a simple machine
  - type: ContainerContainer
    containers:
      machine_board: !type:Container
      machine_parts: !type:Container
      vinyl: !type:ContainerSlot
  - type: ItemSlots
    slots:
      vinyl:
        name: vinyl
        whitelist:
          components:
          - Vinyl
  - type: ItemMapper
    containerWhitelist: [vinyl]
    mapLayers:
      disk_installed:
        whitelist:
          components:
          - Vinyl
  - type: GenericVisualizer
    visuals:
      enum.WiresVisualLayers.MaintenancePanel:
        enum.WiresVisualLayers.MaintenancePanel:
          True: { visible: true }
          False: { visible: false }
      enum.PowerDeviceVisuals.Powered:
        enum.PowerDeviceVisualLayers.Powered:
          True: { visible: true }
          False: { visible: false }

- type: entity
  id: TapeDeck
  name: tape deck
  parent: [ BaseMachinePowered, ConstructibleMachine ]
  description: An old school tape deck, ready to play the newest podcast made by the crew.
  components:
  - type: Transform
    noRot: false
  - type: Sprite
    sprite: _Goobstation/Structures/Machines/StationRadio/tapedeck.rsi
    layers:
    - state: icon
    # TODO: unlit & maints panel sprite
  - type: Rotatable
  - type: TapeRecorder
  - type: ActiveListener
    range: 4
  - type: UseDelay
    delay: 1
  - type: Speech
  - type: ItemSlots
    slots:
      cassette_tape:
        priority: 4
        whitelist:
          components:
          - FitsInTapeRecorder
  - type: ContainerContainer
    containers:
      machine_board: !type:Container
      machine_parts: !type:Container
      cassette_tape: !type:ContainerSlot
  - type: ActivatableUI
    key: enum.TapeRecorderUIKey.Key
  - type: UserInterface
    interfaces:
      enum.TapeRecorderUIKey.Key:
        type: TapeRecorderBoundUserInterface

- type: entity
  id: StationRadioServer
  name: station radio server
  parent: [ BaseMachinePowered, ConstructibleMachine ]
  description: A rack of servers, controls whether your voice is being broadcasted or not
  components:
  - type: Sprite
    sprite: _Goobstation/Structures/Machines/StationRadio/stationradioserver.rsi
    state: broadcastradio
  - type: Anchorable
    delay: 10
  - type: TelecomExempt
  - type: RadioMicrophone
    powerRequired: true
    broadcastChannel: RadioShow
    secondaryBroadcastChannel: Common

- type: entity
  id: StationRadioRig
  parent: [ BaseMachinePowered, ConstructibleMachine ]
  name: station radio rig
  description: A collection of everything you need to play music over the station, has a slot for Cds and vinyls.
  components:
  - type: Sprite
    sprite: _Goobstation/Structures/Machines/StationRadio/radiostationrig.rsi
    state: stationradiosetup
  - type: Anchorable
    delay: 10

- type: entity
  id: RadioVinylPlayer
  name: Vinyl Player
  suffix: Radio
  parent: VinylPlayer
  description: An old school vinyl record player sat on a set of drawers, this one broadcasts whatever you're playing around the station.
  components:
  - type: VinylPlayer
    relayToRadios: true

- type: entity
  id: StationRadioReceiver
  name: station radio
  parent: [ BaseMachinePowered, ConstructibleMachine ]
  description: Listen to the top hits of your stations local radio.
  components:
  - type: StationRadioReceiver
  - type: Sprite
    sprite: _Goobstation/Structures/Machines/StationRadio/stationradio.rsi
    layers:
    - state: icon
    - state: unlit
      shader: unshaded
      map: [ "enum.PowerDeviceVisualLayers.Powered" ]
    drawdepth: SmallObjects
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.10,-0.10,0.10,0.10"
        density: 500
        mask:
        - TabletopMachineMask
        layer:
        - BulletImpassable
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 80
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: MetalGlassBreak
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: RadioSpeaker
    powerRequired: true
    speakNormally: true
    enabled: true
    channels:
    - RadioShow
  - type: Speech
    speechVerb: Robotic
  - type: ActiveRadio
    channels:
    - RadioShow

# Container

- type: entity
  id: CrateRadioStationAds
  parent: CrateGenericSteel
  name: ads crate
  description: A whole crate which sole purpose is to store 6 exclusive ads, aint capitalism great?
  components:
  - type: EntityTableContainerFill
    containers:
      entity_storage: !type:NestedSelector
        tableId: RandomVinylDisk
        rolls: 6

- type: entityTable
  id: RandomVinylDisk
  table: !type:GroupSelector
    children:
    - id: CdDiskDanitosBurritos
      weight: 0.6
    - id: CdDiskBillMovie
      weight: 0.6
    - id: CdDiskCapTraining
      weight: 0.6
    - id: CdDiskCargonia
      weight: 0.6
    - id: CdDiskChemistry
      weight: 0.6
    - id: CdDiskCloningPsa
      weight: 0.6
    - id: CdDiskDansTickets
      weight: 0.6
    - id: CdDiskGrones
      weight: 0.6
    - id: CdDiskPopeCrunchCereal
      weight: 0.6
    - id: CdDiskQuikNoodles
      weight: 0.6
    - id: CdDiskRobotics
      weight: 0.6
    - id: CdDiskSecurityPsa
      weight: 0.6
    - id: CdDiskCommanderAnnouncement
      weight: 0.2
    - id: CdDiskCommanderFigurines
      weight: 0.2
    - id: CdDiskCommanderResignation
      weight: 0.2
    - id: CdDiskCommanderSupport
      weight: 0.2
    - id: CdDiskHeisenbeeTrial
      weight: 0.2
    - id: CdDiskXgOnboarding1
      weight: 0.1
    - id: CdDiskXgOnboarding2
      weight: 0.1
    - id: CdDiskXgOnboarding3
      weight: 0.1
    - id: CdDiskXgOnboarding4
      weight: 0.1
    - id: VinylDiskForgotten
      weight: 0.05
