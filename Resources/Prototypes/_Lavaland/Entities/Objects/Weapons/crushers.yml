# SPDX-FileCopyrightText: 2025 ActiveMammmoth <140334666+ActiveMammmoth@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 ActiveMammmoth <kmcsmooth@gmail.com>
# SPDX-FileCopyrightText: 2025 Aiden <28298836+Aidenkrz@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 Aiden <aiden@djkraz.com>
# SPDX-FileCopyrightText: 2025 Aidenkrz <aiden@djkraz.com>
# SPDX-FileCopyrightText: 2025 Aineias1 <dmitri.s.kiselev@gmail.com>
# SPDX-FileCopyrightText: 2025 FaDeOkno <143940725+FaDeOkno@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 GoobBot <uristmchands@proton.me>
# SPDX-FileCopyrightText: 2025 McBosserson <148172569+McBosserson@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 Milon <plmilonpl@gmail.com>
# SPDX-FileCopyrightText: 2025 Piras314 <p1r4s@proton.me>
# SPDX-FileCopyrightText: 2025 Rouden <149893554+Roudenn@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 TheBorzoiMustConsume <197824988+TheBorzoiMustConsume@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 Unlumination <144041835+Unlumy@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 coderabbitai[bot] <136622811+coderabbitai[bot]@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 deltanedas <39013340+deltanedas@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 deltanedas <@deltanedas:kde.org>
# SPDX-FileCopyrightText: 2025 gluesniffler <159397573+gluesniffler@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 gluesniffler <linebarrelerenthusiast@gmail.com>
# SPDX-FileCopyrightText: 2025 gus <august.eymann@gmail.com>
# SPDX-FileCopyrightText: 2025 keronshb <54602815+keronshb@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 pheenty <fedorlukin2006@gmail.com>
# SPDX-FileCopyrightText: 2025 thebiggestbruh <marcus2008stoke@gmail.com>
# SPDX-FileCopyrightText: 2025 username <113782077+whateverusername0@users.noreply.github.com>
# SPDX-FileCopyrightText: 2025 whateverusername0 <whateveremail>
#
# SPDX-License-Identifier: AGPL-3.0-or-later

- type: entity
  abstract: true
  parent: BaseItem
  id: BaseWeaponCrusher
  name: crusher
  description: An early design of the proto-kinetic accelerator.
  components:
  - type: Appearance
  - type: Item
    size: Ginormous
  - type: MegafaunaWeaponLooter # TODO reconsider this component entirely
  - type: Sharp
  - type: Execution
    doAfterDuration: 4.0
  - type: DisarmMalus
  - type: Prying
  - type: MeleeWeapon
    range: 2 # Enough range so if you're skilled enough you can avoid being hit by a slow enemy
    attackRate: 1
    animationRotation: -135
    wideAnimationRotation: -135
    soundHit:
      collection: MetalThud
  - type: PressureDamageChange
  - type: Wieldable
  - type: GunRequiresWield
  - type: MeleeRequiresWield
  - type: UseDelayBlockMelee
  - type: UseDelay
    delay: 1
  - type: Clothing
    quickEquip: false
    slots:
    - Back
    - suitStorage
  - type: UpgradeableWeapon
  - type: ContainerContainer
    containers:
      flashlight: !type:ContainerSlot
      upgrade_slot_main: !type:ContainerSlot
      upgrade_slot_blade: !type:ContainerSlot
      upgrade_slot_handle: !type:ContainerSlot
  - type: ItemSlots
    slots:
      flashlight:
        name: weapon-upgrade-slot-name-flashlight
        priority: 6
        insertDelay: 0.4
        ejectDelay: 0.2
        ejectOnBreak: true
        occludesLight: false
        whitelist:
          components:
          - GunUpgradeFlashlight
      # Main upgrade is attached to the central part and is used to add actions
      upgrade_slot_main:
        name: weapon-upgrade-slot-name-main
        swap: false
        priority: 5
        insertDelay: 3.0 # This is something major
        ejectDelay: 1.8
        whitelist:
          tags:
          - CrusherUpgradeMain
      # Handle Secondary upgrade improves damage stats
      upgrade_slot_handle:
        name: weapon-upgrade-slot-name-handle
        swap: false
        priority: 3
        insertDelay: 2.4
        ejectDelay: 1.2
        whitelist:
          tags:
          - CrusherUpgradeHandle
      # Blade Special upgrade applies some effects to attacked enemies
      upgrade_slot_blade:
        name: weapon-upgrade-slot-name-blade
        swap: false
        priority: 4
        insertDelay: 2.4
        ejectDelay: 1.2
        whitelist:
          tags:
          - CrusherUpgradeBlade
  - type: ItemMapper
    # Imagine if this would support displacement maps.
    # Not that important, but probably required if gun upgrades will become a major mechanic
    mapLayers:
      flashlight:
        whitelist:
          components:
          - GunUpgradeFlashlight
      upgrade-marker:
        whitelist:
          tags:
          - CrusherUpgradeMainMarker
      upgrade-rude-buster:
        whitelist:
          tags:
          - CrusherUpgradeMainRudeBuster
      upgrade-lava-aspect:
        whitelist:
          tags:
          - CrusherUpgradeBladeLavaAspect
      upgrade-ice-frost:
        whitelist:
          tags:
          - CrusherUpgradeBladeIceFrost
      upgrade-sharpness:
        whitelist:
          tags:
          - CrusherUpgradeBladeSharpness
      upgrade-handle-weights:
        whitelist:
          tags:
          - CrusherUpgradeHandleWeights
      upgrade-handle-lightweight:
        whitelist:
          tags:
          - CrusherUpgradeHandleLightweight
      upgrade-handle-range:
        whitelist:
          tags:
          - CrusherUpgradeHandleRange
  - type: Tag
    tags:
    - Pickaxe

- type: entity
  parent: [ BaseWeaponCrusher, BaseSalvageContraband ]
  id: WeaponCrusher
  name: crusher axe
  description: An early design of the proto-kinetic accelerator.
  components:
  - type: Sprite
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher.rsi
    layers:
    - state: icon
  - type: Item
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher-inhands.rsi
  - type: Clothing
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher.rsi
  - type: MeleeWeapon
    damage:
      types:
        Slash: 6
        Blunt: 5
  - type: IncreaseDamageOnWield
    damage:
      types:
        Slash: 4

- type: entity
  parent: [ BaseWeaponCrusher, BaseSalvageContraband ]
  id: WeaponCrusherGlaive
  name: crusher glaive
  description: An early design of the proto-kinetic accelerator, in glaive form. Provides better healing in exchange for less charged damage.
  components:
  - type: Sprite
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher_glaive.rsi
    state: icon
  - type: Item
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher_glaive-inhands.rsi
  - type: Clothing
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher_glaive.rsi
  #- type: LeechOnMarker # TODO make it a crusher upgrade
  #  leech:
  #    groups:
  #      Brute: -10
  - type: MeleeWeapon
    attackRate: 1.1
    range: 2.5
    animation: WeaponArcThrust
    angle: 0
    animationRotation: -135
    wideAnimationRotation: -135
    damage:
      types:
        Piercing: 5
        Slash: 4
  - type: IncreaseDamageOnWield
    damage:
      types:
        Piercing: 3

- type: entity
  parent: [ BaseWeaponCrusher, BaseSalvageContraband ]
  id: WeaponCrusherHammer
  name: crusher hammer
  description: A beefy, two-handed weapon that inflicts knockback and heavier damage than a crusher.
  components:
  - type: Sprite
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher_hammer.rsi
    state: icon
  - type: MeleeWeapon # Slower attack speed but higher damage makes it more risky and rewarding to use
    attackRate: 0.6
    damage:
      types:
        Blunt: 12
    range: 1.5 # A bit shorter range (default)
  - type: IncreaseDamageOnWield
    damage:
      types:
        Blunt: 13
        Structural: 15 # Decent at mining
  - type: Item
    size: Ginormous
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher_hammer-inhands.rsi
  - type: Tool
    speedModifier: 1.5
    useSound:
      path: /Audio/Items/trayhit2.ogg
    qualities:
    - Hammering

- type: entity
  parent: [ BaseWeaponCrusher, BaseSalvageContraband ]
  id: WeaponCrusherHalberd
  name: crusher halberd
  description: A universal weapon that combines the power of a crusher and the range of a spear.
  components:
  - type: Sprite
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher_halberd.rsi
    state: icon
  - type: Item
    size: Ginormous
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher_halberd-inhands.rsi
  - type: Clothing
    sprite: _Lavaland/Objects/Weapons/Crushers/crusher_halberd.rsi
  # Basically a crusher but better
  - type: MeleeWeapon
    range: 2.2
    damage:
      types:
        Blunt: 8
        Slash: 3
  - type: IncreaseDamageOnWield
    damage:
      types:
        Piercing: 6
        Slash: 3
        Structural: 30 # Breaks weak rocks effectively

# Random upgrades
- type: entity
  id: CrusherRandomUpgradesFill
  suffix: Random Upgrades
  abstract: true
  components:
  - type: EntityTableContainerFill
    containers:
      flashlight:
        id: FlashlightSeclite
        prob: 0.5
      upgrade_slot_main: !type:NestedSelector
        tableId: CrusherUpgradesMain
        prob: 0.67
      upgrade_slot_blade: !type:NestedSelector
        tableId: CrusherUpgradesBlade
        prob: 0.75
      upgrade_slot_handle: !type:NestedSelector
        tableId: CrusherUpgradesHandle
        prob: 0.75

- type: entity
  parent: [ WeaponCrusher, CrusherRandomUpgradesFill ]
  id: WeaponCrusherFilledRandom

- type: entity
  parent: [ WeaponCrusherGlaive, CrusherRandomUpgradesFill ]
  id: WeaponCrusherGlaiveFilledRandom

- type: entity
  parent: [ WeaponCrusherHammer, CrusherRandomUpgradesFill ]
  id: WeaponCrusherHammerFilledRandom

- type: entity
  parent: [ WeaponCrusherHalberd, CrusherRandomUpgradesFill ]
  id: WeaponCrusherHalberdFilledRandom

# Entity Tables
- type: entityTable
  id: CrusherWeapons
  table: !type:GroupSelector
    children:
    - id: WeaponCrusher
    - id: WeaponCrusherGlaive
    - id: WeaponCrusherHammer
    - id: WeaponCrusherHalberd
