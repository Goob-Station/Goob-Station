################################
# Core structural base
################################

- type: entity
  id: BaseFenceMetalReinforced
  abstract: true
  name: reinforced fence
  description: A plasteel fence that is much harder to break. Ignores insulation when powered.
  placement:
    mode: SnapgridCenter
  components:
  - type: Clickable
  - type: Transform
    anchored: true
  - type: Physics
    bodyType: Static
  - type: MeleeSound
    soundGroups:
      Brute:
        path: "/Audio/Weapons/grille_hit.ogg"
  - type: Damageable
    damageContainer: StructuralInorganic
    damageModifierSet: Metallic
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 800 # Be my guest
      behaviors:
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: Climbable
    delay: 30 # If you want to, be my guest
    startClimbSound:
      collection: FenceRattle
    finishClimbSound:
      collection: FenceRattle


################################
# Visual base (NO electrified logic)
################################

- type: entity
  id: BaseFenceMetalReinforcedVisual
  abstract: true
  parent: BaseFenceMetalReinforced
  components:
  - type: Sprite
    sprite: _Lavaland/Structures/Walls/reinforced_fence.rsi
    drawdepth: WallTops
  - type: Appearance


################################
# Electrified base (power-controlled)
################################

- type: entity
  id: BaseFenceMetalReinforcedElectrified
  abstract: true
  components:
  - type: Electrified
    requirePower: true
    ignoreInsulation: true
    shockDamage: 40
    alwaysShowSparks: true
    noWindowInTile: true
  - type: GenericVisualizer
    visuals:
      enum.ElectrifiedVisuals.ShowSparks:
        enum.ElectrifiedLayers.Sparks:
          True:  { visible: True }
          False: { visible: False }


################################
# Electrified base (ALWAYS ON visuals)
################################

- type: entity
  id: BaseFenceMetalReinforcedElectrifiedAlwaysOn
  abstract: true
  components:
  - type: Electrified
    requirePower: false
    ignoreInsulation: true
    shockDamage: 40
    alwaysShowSparks: true
    noWindowInTile: true
  - type: GenericVisualizer
    visuals:
      enum.ElectrifiedVisuals.ShowSparks:
        enum.ElectrifiedLayers.Sparks:
          True:  { visible: True }
          False: { visible: True }


################################
# Straight fence
################################

- type: entity
  id: FenceMetalReinforcedStraight
  parent: BaseFenceMetalReinforcedVisual
  components:
  - type: Sprite
    layers:
    - state: straight
    - state: electrified
      sprite: Effects/electricity.rsi
      map: ["enum.ElectrifiedLayers.Sparks"]
      shader: unshaded
      visible: false
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.10,-0.5,0.10,0.5"
        density: 2000
        mask: [ FullTileMask ]
        layer:
        - MidImpassable
        - LowImpassable


- type: entity
  id: FenceMetalReinforcedStraightAlwaysOn
  parent:
  - FenceMetalReinforcedStraight
  - BaseFenceMetalReinforcedElectrifiedAlwaysOn
  suffix: Always On


################################
# Corner fence
################################

- type: entity
  id: FenceMetalReinforcedCorner
  parent: BaseFenceMetalReinforcedVisual
  suffix: Corner
  components:
  - type: Sprite
    layers:
    - state: corner
    - state: electrified
      sprite: Effects/electricity.rsi
      map: ["enum.ElectrifiedLayers.Sparks"]
      shader: unshaded
      visible: false
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.1,-0.1,0.1,0.5"
        density: 2000
        mask: [ TableMask ]
        layer: [ TableLayer ]
      fix2:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.5,-0.1,-0.1,0.1"
        density: 2000
        mask: [ TableMask ]
        layer:
        - MidImpassable
        - LowImpassable


- type: entity
  id: FenceMetalReinforcedCornerAlwaysOn
  parent:
  - FenceMetalReinforcedCorner
  - BaseFenceMetalReinforcedElectrifiedAlwaysOn
  suffix: Always On


################################
# Gate
################################

- type: entity
  id: FenceMetalReinforcedGate
  parent: BaseFenceMetalReinforcedVisual
  name: reinforced fence gate
  components:
  - type: Sprite
    layers:
    - state: end
      map: ["enum.DoorVisualLayers.Base"]
    - state: electrified
      sprite: Effects/electricity.rsi
      map: ["enum.ElectrifiedLayers.Sparks"]
      shader: unshaded
      visible: false
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.5,-0.1,0.5,0.1"
        density: 2000
        mask: [ TableMask ]
        layer:
        - MidImpassable
        - LowImpassable
  - type: InteractionOutline
  - type: Door
    openSpriteState: door_opened
    closedSpriteState: door_closed
    canPry: false
    occludes: false
    changeAirtight: false
    bumpOpen: false
    clickOpen: true
    canCrush: false
    closeTimeOne: 0
    closeTimeTwo: 0
    openTimeOne: 0
    openTimeTwo: 0
    openingAnimationTime: 0
    closingAnimationTime: 0


- type: entity
  id: FenceMetalReinforcedGateAlwaysOn
  parent:
  - FenceMetalReinforcedGate
  - BaseFenceMetalReinforcedElectrifiedAlwaysOn
  suffix: Always On
