name: "Mald check"
on:
  pull_request_target:
    types:
      - opened

jobs:
  no-mald:
    if: ( github.event.pull_request.draft == false )
    runs-on: ubuntu-latest
    steps:
      - name: Check out PR
        uses: actions/checkout@v4.2.2
        with:
          ref: ${{ github.event.pull_request.head.sha }}
      - name: Check if assistant.yml was changed
        id: check_file
        run: |
            if git diff --name-only origin/${{ github.event.pull_request.base.ref }} | grep -q '^Resources/Prototypes/Roles/Jobs/Civilian/assistant\.yml$'; then
                echo "changed=true" >> $GITHUB_OUTPUT
            else
                echo "changed=false" >> $GITHUB_OUTPUT
            fi
      - name: Close PR if assistant.yml was changed
        if: steps.check_file.outputs.changed == 'true'
        uses: peter-evans/close-pull@v3
        with:
            comment: "This PR touches assistant.yml and has been automatically closed."
